<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Trellis | Email Confirmation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>
  <div class="modal modal-sheet position-static d-block bg-body-secondary p-4 py-md-5" tabindex="-1" role="dialog"
    id="modalSheet">
    <div class="modal-dialog" role="document">
      <div class="modal-content rounded-4 shadow">
        <div class="modal-header border-bottom-0">
          <h1 class="modal-title fs-5">Email confirmation</h1>
        </div>
        <div class="modal-body py-0" id="message">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="https://unpkg.com/realm-web/dist/bundle.iife.js"></script>
<script>
  const app = new Realm.App({ id: "trellis-ymoit" });

  async function tryConfirmUser() {
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token')
    const tokenId = urlParams.get('tokenId')
    if (token && tokenId) {
      try {
        await app.emailPasswordAuth.confirmUser({ token, tokenId });
        document.querySelector("#message").innerHTML = `<p>Your Email address has been confirmed. Thank you.</p>`
        window.location = "trellisapp://"
      } catch (error) {
        document.querySelector("#message").innerHTML = `<p>Something is wrong. Please try again.</p>`
      }
    }
  }

  tryConfirmUser();
</script>

</html>